LIBRARY ieee; 
USE ieee.std_logic_1164.all;

ENTITY BUS_INTERFACE IS
PORT ( Dout: OUT STD_LOGIC_VECTOR (7 DOWNTO 0);
TX_out: OUT STD_LOGIC_VECTOR (7 DOWNTO 0);
RX_in,Din:IN STD_LOGIC_VECTOR (7 DOWNTO 0);
CLOCK,RESET: IN STD_LOGIC
);
END BUS_INTERFACE;

ARCHITECTURE STR OF BUS_INTERFACE IS

COMPONENT bus_interfaceDP IS
PORT(Dout: OUT STD_LOGIC_VECTOR (7 DOWNTO 0);
TX_out: OUT STD_LOGIC_VECTOR (7 DOWNTO 0);
RX_in,Din:IN STD_LOGIC_VECTOR (7 DOWNTO 0);
ADD: IN STD_LOGIC_VECTOR (2 DOWNTO 0);
R_Wn,CS,ATNack,RESET,CLOCK: IN STD_LOGIC;
RX_ENABLE,TX_ENABLE,CLRatn: OUT STD_LOGIC;
EN_CTRL,EN_DATARx,EN_DATATx : IN STD_LOGIC;
ATN,TX_ACK: OUT STD_LOGIC;
SEL_MUX: IN STD_LOGIC;
FF_IN: IN STD_LOGIC_VECTOR(2 DOWNTO 0);
ENABLE_FF: IN STD_LOGIC_VECTOR (2 DOWNTO 0);
FF_OUT : OUT STD_LOGIC_VECTOR ( 2 DOWNTO 0));
END COMPONENT;


COMPONENT ControlUnit_bus IS 
PORT        (  
                  RESET,CLOCK: IN STD_LOGIC;                      
                            CS_cu,R_Wn_cu: IN STD_LOGIC; 
                            EN_STATE: OUT STD_LOGIC_VECTOR (2 DOWNTO 0);									 
                              ADD_cu: IN STD_LOGIC_VECTOR (2 DOWNTO 0); 
                           SEL_mux_cu,ATN_cu,EN_regCTRL,EN_regDATARX,EN_regDATATX: OUT STD_LOGIC;                                                       
                             TX_ack_cu,EN_RX_cu,EN_TX_cu: OUT STD_LOGIC;
									  CLRatn_cu : BUFFER STD_LOGIC;
                               RX_FULL_cu,TX_EMPTY_cu,ERROR_cu,ATNack_cu: IN STD_LOGIC);
END COMPONENT;



SIGNAL CS_s,R_Wn_s : STD_LOGIC;
SIGNAL SEL_MUX_s : STD_LOGIC;
SIGNAL  FF_IN_s : STD_LOGIC_VECTOR ( 2 DOWNTO 0);
SIGNAL ENABLE_RX_s,ENABLE_TX_s, CLRatn_s : STD_LOGIC;
SIGNAL ATNack_s,TX_ack_s,ATN_s : STD_LOGIC;
SIGNAL ADD_s : STD_LOGIC_VECTOR (2 DOWNTO 0);
SIGNAL ENABLE_FF_s : STD_LOGIC_VECTOR (2 DOWN TO 0);
SIGNAL EN_CTRL_s,EN_DATARX_S,EN_DATATX_s : STD_LOGIC;


BEGIN 

DATAPATH:
bus_interfaceDP PORT MAP ( Dout => Dout, TX_out => TX_out, RX_in => RX_in, Din => Din,
                           ADD => ADD_s, R_Wn => R_Wn_s, CS <= CS_s, ATNack => ATNack_s,
									RESET => RESET, CLOCK => CLOCK, RX_ENABLE => ENABLE_RX_s, 
									TX_ENABLE => ENABLE_TX_s, CLRatn => CLRan_s, EN_CTRL => EN_CTRL_s,
									EN_DATARx => EN_DATARX_s, EN_DATATx => EN_DATATX_s, ATN => ATN_s,
									TX_ACK => TX_ack_s, SEL_MUX => SEL_MUX_s,FF_IN => FF_IN_s,
									ENABLE_FF <= ENABLE_FF_s,
